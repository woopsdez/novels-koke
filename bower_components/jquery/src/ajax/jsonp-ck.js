define(["../core","./var/nonce","./var/rquery","../ajax"],function(e,t,n){var r=[],i=/(=)\?(?=&|$)|\?\?/;e.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var n=r.pop()||e.expando+"_"+t++;this[n]=!0;return n}});e.ajaxPrefilter("json jsonp",function(t,s,o){var u,a,f,l=t.jsonp!==!1&&(i.test(t.url)?"url":typeof t.data=="string"&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&i.test(t.data)&&"data");if(l||t.dataTypes[0]==="jsonp"){u=t.jsonpCallback=e.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback;l?t[l]=t[l].replace(i,"$1"+u):t.jsonp!==!1&&(t.url+=(n.test(t.url)?"&":"?")+t.jsonp+"="+u);t.converters["script json"]=function(){f||e.error(u+" was not called");return f[0]};t.dataTypes[0]="json";a=window[u];window[u]=function(){f=arguments};o.always(function(){window[u]=a;if(t[u]){t.jsonpCallback=s.jsonpCallback;r.push(u)}f&&e.isFunction(a)&&a(f[0]);f=a=undefined});return"script"}})});