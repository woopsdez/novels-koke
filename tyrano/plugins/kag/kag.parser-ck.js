tyrano.plugin.kag.parser={tyrano:null,kag:null,flag_script:!1,init:function(){},loadConfig:function(e){var t=this;$.loadText("./data/system/Config.tjs",function(n){var r=t.compileConfig(n);e&&e(r)})},compileConfig:function(e){var t="",n={},r=e.split("\n");for(var i=0;i<r.length;i++)try{var s=$.trim(r[i]);if(s!=""&&s.substr(0,1)===";"){var o=s.split("//");o.length>1&&(s=$.trim(o[0]));s=$.replaceAll(s,";","");s=$.replaceAll(s,'"',"");var u=s.split("="),a=$.trim(u[0]),f=$.trim(u[1]);n[a]=f}}catch(l){t+="Error:Config.tjsに誤りがあります/行:"+i+""}t!=""&&alert(t);return n},parseScenario:function(e){var t=[],n={},r=e.split("\n"),i=!1;for(var s=0;s<r.length;s++){var o=$.trim(r[s]),u=o.substr(0,1);o.indexOf("endscript")!=-1&&(this.flag_script=!1);if(i===!0&&o==="*/")i=!1;else if(o==="/*")i=!0;else if(i!=1&&u!==";")if(u==="#"){var a=$.trim(o.replace("#","")),f="",l="";if(a.split(":").length>1){var c=a.split(":");f=c[0];l=c[1]}else f=a;var h={line:s,name:"chara_ptext",pm:{name:f,face:l},val:w};t.push(h)}else if(u==="*"){var p=o.substr(1,o.length).split("|"),d="",v="";d=$.trim(p[0]);p.length>1&&(v=$.trim(p[1]));var m={name:"label",pm:{line:s,index:t.length,label_name:d,val:v},val:v};t.push(m);n[m.pm.label_name]?this.kag.warning("警告:"+s+"行目:"+"ラベル名「"+m.pm.label_name+"」は同一シナリオファイル内に重複しています"):n[m.pm.label_name]=m.pm}else if(u==="@"){var g=o.substr(1,o.length),y=this.makeTag(g,s);t.push(y)}else{u==="_"&&(o=o.substring(1,o.length));var b=o.split(""),w="",g="",E=!1,S=0;for(var x=0;x<b.length;x++){var T=b[x];if(E===!0)if(T==="]"&&this.flag_script==0){S--;if(S==0){E=!1;t.push(this.makeTag(g,s));g=""}else g+=T}else if(T==="["&&this.flag_script==0){S++;g+=T}else g+=T;else if(E===!1&&T==="["&&this.flag_script==0){S++;if(w!=""){var h={line:s,name:"text",pm:{val:w},val:w};t.push(h);w=""}E=!0}else w+=T}if(w!=""){var h={line:s,name:"text",pm:{val:w},val:w};t.push(h)}}}var N={array_s:t,map_label:n};return N},makeTag:function(e,t){var n={line:t,name:"",pm:{},val:""},r=e.split(""),i="",s="";for(var o=0;o<r.length;o++){var u=r[o];if(i!=""||u!=='"'&&u!=="'")if(i!="")if(u===i)i="";else{u=="="&&(u="#");u==" "&&(u="");s+=u}else s+=u;else i=u}e=s;var a=e.split(" ");n.name=$.trim(a[0]);for(var f=1;f<a.length;f++)if(a[f]==""){a.splice(f,1);f--}else if(a[f]==="="){if(a[f-1]&&a[f+1]){a[f-1]=a[f-1]+"="+a[f+1];a.splice(f,2);f--}}else if(a[f].substr(0,1)==="="){if(a[f-1]&&a[f]){a[f-1]=a[f-1]+a[f];a.splice(f,1)}}else if(a[f].substr(a[f].length-1,a[f].length)==="="&&a[f+1]&&a[f]){a[f]=a[f]+a[f+1];a.splice(f+1,1)}for(var l=1;l<a.length;l++){var c=$.trim(a[l]).split("="),h=$.trim(c[0]),p=$.trim(c[1]),d={};d[h]=p;n.pm[h]=$.replaceAll(p,"#","=")}n.name=="iscript"&&(this.flag_script=!0);n.name=="endscript"&&(this.flag_script=!1);return n},test:function(){}};