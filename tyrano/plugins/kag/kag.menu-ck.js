tyrano.plugin.kag.menu={tyrano:null,kag:null,snap:null,init:function(){},showMenu:function(e){var t=this;this.kag.stat.is_skip=!1;var n=this.kag.layer.getMenuLayer();n.html("");var r='<div class="display_menu" style="z-index: 10000; width:100%; height:100%; position: absolute; display:block;" align="center">    <div class="menu_item menu_close" style="float:right;width:64px;"><img src="tyrano/images/kag/menu_button_close.png" /></div>    <div style="clear:both"></div>    <div class="menu_item menu_save"><img src="tyrano/images/kag/menu_button_save.gif" /></div>    <div class="menu_item menu_load"><img src="tyrano/images/kag/menu_button_load.gif" /></div>    <div class="menu_item menu_window_close"><img src="tyrano/images/kag/menu_message_close.gif" /></div>    <div class="menu_item menu_skip"><img src="tyrano/images/kag/menu_button_skip.gif" /></div>    <div class="menu_item menu_back_title"><img src="tyrano/images/kag/menu_button_title.gif" /></div></div>',i=$("<img src='tyrano/images/kag/menu_bg.jpg' style=left:0px;top:0px;position:absolute;z-index:100' />");i.css("width",this.kag.config.scWidth);i.css("height",this.kag.config.scHeight);n.append(i);var s=$(r);n.append(s);n.find(".menu_skip").click(function(){n.html("");n.hide();$(".button_menu").show();t.kag.stat.is_skip=!0;t.kag.ftag.nextOrder()});n.find(".menu_close").click(function(){n.hide();$(".button_menu").show()});n.find(".menu_window_close").click(function(){t.kag.layer.hideMessageLayers();n.hide();$(".button_menu").show()});n.find(".menu_save").click(function(){t.displaySave()});n.find(".menu_load").click(function(){t.displayLoad()});n.find(".menu_back_title").click(function(){location.reload()});n.show();$(".button_menu").hide()},displaySave:function(){var e=this;this.kag.stat.is_skip=!1;var t=e.getSaveData(),n=t.data,r=$("<div></div>");for(var i=0;i<n.length;i++)(function(){var t=n[i],s=i,o="<div class='save_display_area' style=''><span class='save_menu_date_font' style=''>【"+(i+1)+"】"+t.save_date+"</span><br/><span class='save_menu_text_font' style=''>"+t.title+"</span></div>",u=$(o);r.append(u);u.css("cursor","pointer");u.click(function(){e.snap=null;e.doSave(s);var t=e.kag.layer.getMenuLayer();t.hide();$(".button_menu").show()})})();var s=$("<img src='tyrano/images/kag/menu_save_bg.jpg' style='z-index:-1;left:0px;top:0px;position:absolute;' />");s.css("width",this.kag.config.scWidth);s.css("height",this.kag.config.scHeight);r.append(s);e.setMenu(r)},doSave:function(e){var t=this.getSaveData(),n={};this.snap==null&&this.snapSave(this.kag.stat.current_message_str);if(this.snap.stat.is_strong_stop==1){alert("ここではセーブできません");return!1}n=this.snap;n.save_date=$.getNowDate()+"　"+$.getNowTime();t.data[e]=n;$.setStorage(this.kag.config.projectID+"_tyrano_data",t)},snapSave:function(e,t,n){t=t||"";n=n||"";var r={};r.title=e;r.stat=this.kag.stat;r.current_order_index=this.kag.ftag.current_order_index;r.save_date=$.getNowDate()+"　"+$.getNowTime();var i=this.kag.layer.getLayeyHtml();r.layer=i;this.snap=$.extend(!0,{},$.cloneObject(r));t!=""&&(this.snap.stat.current_scenario=t);n!=""&&(this.snap.current_order_index=n)},displayLoad:function(){var e=this;this.kag.stat.is_skip=!1;var t=e.getSaveData(),n=t.data,r=$("<div></div>");for(var i=0;i<n.length;i++)(function(){var t=n[i],s=i,o="<div class='save_display_area' style=''><span class='save_menu_date_font' style=''>【"+(i+1)+"】"+t.save_date+"</span><br/><span class='save_menu_text_font' style=''>"+t.title+"</span></div>",u=$(o);r.append(u);u.css("cursor","pointer");u.click(function(){e.loadGame(s);var t=e.kag.layer.getMenuLayer();t.hide();$(".button_menu").show()})})();var s=$("<img src='tyrano/images/kag/menu_load_bg.jpg' style='z-index:-1;left:0px;top:0px;position:absolute;' />");s.css("width",this.kag.config.scWidth);s.css("height",this.kag.config.scHeight);r.append(s);e.setMenu(r)},loadGame:function(e){var t=this.getSaveData(),n=t.data,r="yes";data=$.extend(!0,{},n[e]);this.kag.layer.setLayerHtml(data.layer);this.kag.stat=data.stat;this.kag.stat.is_strong_stop=!1;this.kag.ftag.startTag("stopbgm",{stop:"true"});this.kag.ftag.startTag("stopse",{stop:"true"});if(this.kag.stat.current_bgm!=""){var i=this.kag.stat.current_bgm,s={loop:"true",storage:i,stop:"true"};this.kag.ftag.startTag("playbgm",s)}var o={name:"call",pm:{storage:"make.ks"},val:""};this.kag.ftag.nextOrderWithIndex(data.current_order_index,data.stat.current_scenario,!0,o,r)},setMenu:function(e){var t=this,n=this.kag.layer.getMenuLayer();n.html("");var r="<div class='menu_item menu_close' style='float:right;'><img src='tyrano/images/kag/menu_button_close.png' /></div><div style='clear:both'></div>",i=$(r);n.append(i);n.find(".menu_close").click(function(){n.hide();$(".button_menu").show();t.kag.ftag.nextOrder()});n.show();n.append(e)},hideMenu:function(){},getSaveData:function(){var tmp_array=$.getStorage(this.kag.config.projectID+"_tyrano_data");if(tmp_array)return eval("("+tmp_array+")");tmp_array=new Array;var root={kind:"save"};for(var i=0;i<5;i++){var json={};json.title="まだ、保存されているデータがありません";json.current_order_index=0;json.save_date="　";json.stat={};tmp_array.push(json)}root.data=tmp_array;return root},test:function(){}};