tyrano.plugin.kag.ftag={tyrano:null,kag:null,array_tag:[],master_tag:{},current_order_index:-1,init:function(){for(var e in tyrano.plugin.kag.tag){this.master_tag[e]=object(tyrano.plugin.kag.tag[e]);this.master_tag[e].kag=this.kag}},buildTag:function(e,t){this.array_tag=e;t?this.nextOrderWithLabel(t):this.nextOrderWithLabel("")},buildTagIndex:function(e,t,n){this.array_tag=e;this.nextOrderWithIndex(t,undefined,undefined,undefined,n)},completeTrans:function(){if(this.kag.stat.is_stop==1){this.kag.layer.showEventLayer();this.nextOrder()}},hideNextImg:function(){$(".img_next").remove();$("#glyph_image").hide()},nextOrder:function(){this.kag.layer.layer_event.hide();var e=this;if(this.kag.stat.is_strong_stop==1)return!1;try{this.current_order_index++;if(this.array_tag.length<=this.current_order_index){this.kag.endStorage();return!1}var t=$.cloneObject(this.array_tag[this.current_order_index]);this.kag.stat.current_line=t.line;this.kag.log("**:"+this.current_order_index+"　line:"+t.line);this.kag.log(t);if(this.kag.stat.flag_ref_page==1){this.kag.stat.flag_ref_page=!1;this.kag.ftag.hideNextImg();this.kag.getMessageInnerLayer().html("")}if(this.checkCond(t)!=1){this.nextOrder();return}if(this.kag.stat.is_hide_message==1){this.kag.layer.showMessageLayers();this.kag.stat.is_hide_message=!1}if(this.master_tag[t.name]){t.pm=this.convertEntity(t.pm);var n=this.checkVital(t);this.checkCw(t)&&this.kag.layer.layer_event.show();n!=""?this.kag.error(n):this.master_tag[t.name].start($.extend(!0,$.cloneObject(this.master_tag[t.name].pm),t.pm))}else if(this.kag.stat.map_macro[t.name]){t.pm=this.convertEntity(t.pm);var r=t.pm,i=this.kag.stat.map_macro[t.name],s={};s.index=this.kag.ftag.current_order_index;s.storage=this.kag.stat.current_scenario;s.pm=r;this.kag.stat.mp=r;this.kag.pushStack("macro",s);this.kag.ftag.nextOrderWithIndex(i.index,i.storage)}else{$.error_message("タグ：["+t.name+"]は存在しません");this.nextOrder()}}catch(o){console.log(o);e.kag.error("エラーが発生しました。スクリプトを確認して下さい")}},checkCw:function(e){var t=this.master_tag[e.name];return t.cw?this.kag.stat.is_script!=1&&this.kag.stat.is_html!=1&&this.kag.stat.checking_macro!=1?!0:!1:!1},nextOrderWithTag:function(e){try{this.current_order_index++;var t=this.array_tag[this.current_order_index];this.checkCond(t)!=1;if(e[t.name]==""){if(this.master_tag[t.name]){t.pm=this.convertEntity(t.pm);this.master_tag[t.name].start($.extend(!0,$.cloneObject(this.master_tag[t.name].pm),t.pm));return!0}return!1}return!1}catch(n){console.log(this.array_tag);return!1}},convertEntity:function(e){var t=this;e["*"]==""&&(e=$.extend(!0,$.cloneObject(e),this.kag.stat.mp));for(key in e){var n=e[key],r="";n.length>0&&(r=n.substr(0,1));if(n.length>0&&r==="&")e[key]=this.kag.embScript(n.substr(1,n.length));else if(n.length>0&&r==="%"){var i=this.kag.getStack("macro");i&&(e[key]=i.pm[n.substr(1,n.length)]);var s=n.split("|");s.length==2&&(i.pm[$.trim(s[0]).substr(1,$.trim(s[0]).length)]?e[key]=i.pm[$.trim(s[0]).substr(1,$.trim(s[0]).length)]:e[key]=$.trim(s[1]))}}return e},checkVital:function(e){var t=this.master_tag[e.name],n="";if(!t.vital)return"";var r=t.vital;for(var i=0;i<r.length;i++)e.pm[r[i]]?e.pm[r[i]]==""&&(n+="タグ「"+e.name+"」にパラメーター「"+r[i]+"」は必須です　\n"):n+="タグ「"+e.name+"」にパラメーター「"+r[i]+"」は必須です　\n";return n},checkCond:function(e){var t=e.pm;if(t.cond){var n=t.cond;return this.kag.embScript(n)}return!0},startTag:function(e,t){this.master_tag[e].start($.extend(!0,$.cloneObject(this.master_tag[e].pm),t))},nextOrderWithLabel:function(e,t){this.kag.stat.is_strong_stop=!1;if(e=="*savesnap"){var n=this.kag.menu.snap,r=n.current_order_index,i=n.stat.current_scenario;this.nextOrderWithIndex(r,i,undefined,undefined,"snap");return}var s=this,o=t;e=e||"";t=t||this.kag.stat.current_scenario;e=e.replace("*","");if(t!=this.kag.stat.current_scenario&&o!=null){this.kag.layer.hideEventLayer();this.kag.loadScenario(t,function(t){s.kag.layer.showEventLayer();s.kag.ftag.buildTag(t,e)});return}if(e==""){this.current_order_index=-1;this.nextOrder()}else if(this.kag.stat.map_label[e]){var u=this.kag.stat.map_label[e];this.current_order_index=u.index;this.nextOrder()}else{$.error_message("ラベル名：「"+e+"」は存在しません");this.nextOrder()}},nextOrderWithIndex:function(e,t,n,r,i){this.kag.stat.is_strong_stop=!1;this.kag.layer.showEventLayer();var s=this;n=n||!1;i=i||"yes";t=t||this.kag.stat.current_scenario;if(t!=this.kag.stat.current_scenario||n==1){this.kag.layer.hideEventLayer();this.kag.loadScenario(t,function(t){typeof r=="object"&&t.splice(e+1,0,r);s.kag.layer.showEventLayer();s.kag.ftag.buildTagIndex(t,e,i)});return}this.current_order_index=e;if(i=="yes")this.nextOrder();else if(i=="snap"){this.kag.stat.is_strong_stop=this.kag.menu.snap.stat.is_strong_stop;this.kag.stat.is_skip==1&&this.kag.stat.is_strong_stop==0&&this.kag.ftag.nextOrder()}else i=="stop"&&(this.kag.stat.is_strong_stop=!0)}};tyrano.plugin.kag.tag.text={cw:!0,pm:{val:""},start:function(e){if(this.kag.stat.is_script==1){this.kag.stat.buff_script+=e.val+"\n";this.kag.ftag.nextOrder();return}if(this.kag.stat.is_html==1){this.kag.stat.map_html.buff_html+=e.val;this.kag.ftag.nextOrder();return}var t=this.kag.getMessageInnerLayer();t.css("letter-spacing",this.kag.config.defaultPitch+"px").css("line-height",parseInt(this.kag.config.defaultFontSize)+parseInt(this.kag.config.defaultLineSpacing)+"px").css("font-family",this.kag.config.userFace);this.kag.stat.current_message_str=e.val;if(this.kag.stat.vertical=="true"){if(this.kag.config.defaultAutoReturn!="false"){var n=this.kag.getMessageOuterLayer(),r=parseInt(n.css("width"))*.8,i=parseInt(t.find("p").css("width"));i>r&&this.kag.getMessageInnerLayer().html("")}this.showMessageVertical(e.val)}else{if(this.kag.config.defaultAutoReturn!="false"){var n=this.kag.getMessageOuterLayer(),s=parseInt(n.css("height"))*.8,o=parseInt(t.find("p").css("height"));o>s&&this.kag.getMessageInnerLayer().html("")}this.showMessage(e.val)}},showMessage:function(e){var t=this;this.kag.pushBackLog(e);t.kag.ftag.hideNextImg();(function(n){n.html()==""&&n.append("<p class=''></p>");var r=e,i="";n.find("p").find(".current_span").length!=0&&(i=n.find("p").find(".current_span").html());var s=0;t.kag.checkMessage(n);var o=t.kag.getMessageCurrentSpan();o.css("color",t.kag.stat.font.color).css("font-weight",t.kag.stat.font.bold).css("font-size",t.kag.stat.font.size+"px").css("font-family",t.kag.stat.font.face);var u=function(e){var o=r.substring(s,++s);if(t.kag.stat.ruby_str!=""){o="<ruby><rb>"+o+"</rb><rt>"+t.kag.stat.ruby_str+"</rt></ruby>";t.kag.stat.ruby_str=""}i+=o;t.kag.appendMessage(n,i);if(s<=r.length){t.kag.stat.is_adding_text=!0;t.kag.stat.is_click_text==1||t.kag.stat.is_skip==1||t.kag.stat.is_nowait==1?setTimeout(function(){e(e)},0):setTimeout(function(){e(e)},t.kag.stat.ch_speed)}else{t.kag.stat.is_adding_text=!1;t.kag.stat.is_click_text=!1;t.kag.stat.is_stop!="true"&&t.kag.ftag.nextOrder();if(t.kag.stat.flag_glyph=="false"){$(".img_next").remove();n.find("p").append("<img class='img_next' src='./tyrano/images/kag/nextpage.gif' />")}else $("#glyph_image").show()}};u(u)})(this.kag.getMessageInnerLayer())},showMessageVertical:function(e){var t=this;t.kag.ftag.hideNextImg();(function(n){n.html()==""&&n.append("<p class='vertical_text'></p>");var r=e,i="";n.find("p").find(".current_span").length!=0&&(i=n.find("p").find(".current_span").html());var s=0;t.kag.checkMessage(n);var o=t.kag.getMessageCurrentSpan();o.css("color",t.kag.stat.font.color).css("font-weight",t.kag.stat.font.bold).css("font-size",t.kag.stat.font.size+"px").css("font-family",t.kag.stat.font.face);var u=function(e){var o=r.substring(s,++s);if(t.kag.stat.ruby_str!=""){o="<ruby><rb>"+o+"</rb><rt>"+t.kag.stat.ruby_str+"</rt></ruby>";t.kag.stat.ruby_str=""}i+=o;t.kag.appendMessage(n,i);if(s<=r.length){t.kag.stat.is_adding_text=!0;t.kag.stat.is_click_text==1||t.kag.stat.is_skip==1?setTimeout(function(){e(e)},0):setTimeout(function(){e(e)},t.kag.stat.ch_speed)}else{t.kag.stat.is_adding_text=!1;t.kag.stat.is_click_text=!1;t.kag.ftag.nextOrder();if(t.kag.stat.flag_glyph=="false"){$(".img_next").remove();n.find("p").append("<img class='img_next' src='./tyrano/images/kag/nextpage.gif' />")}else $("#glyph_image").show()}};u(u)})(this.kag.getMessageInnerLayer())},nextOrder:function(){},test:function(){}};tyrano.plugin.kag.tag.label={pm:{},start:function(e){if(this.kag.config.autoRecordPageShowing=="true"){var t="sf.trail_"+this.kag.stat.current_scenario.replace(".ks","").replace(/\u002f/g,"").replace(/:/g,"").replace(/./g,"")+"_"+e.label_name+"",n="";+t+" = "+t+"  || 0;"+t+"++;";this.kag.evalScript(n)}this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.l={cw:!0,start:function(){this.kag.stat.is_skip==1&&this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.p={cw:!0,start:function(){this.kag.stat.flag_ref_page=!0;this.kag.stat.is_skip==1&&this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.graph={vital:["storage"],pm:{storage:null},start:function(e){var t=this.kag.getMessageInnerLayer(),n="";t.find("p").find(".current_span").length!=0&&(n=t.find("p").find(".current_span").html());var r="";$.isHTTP(e.storage)?r=e.storage:r="./data/image/"+e.storage;this.kag.appendMessage(t,n+"<img src='"+r+"' >");this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.jump={pm:{storage:null,target:null,countpage:!0},start:function(e){this.kag.ftag.nextOrderWithLabel(e.target,e.storage)}};tyrano.plugin.kag.tag.r={start:function(){var e=this.kag.getMessageInnerLayer(),t=e.find("p").find(".current_span").html()+"<br />";e.find("p").find(".current_span").html(t);this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.er={start:function(){this.kag.ftag.hideNextImg();this.kag.getMessageInnerLayer().html("");this.kag.ftag.startTag("resetfont")}};tyrano.plugin.kag.tag.cm={start:function(){this.kag.ftag.hideNextImg();this.kag.layer.clearMessageInnerLayerAll();this.kag.layer.getFreeLayer().html("").hide();this.kag.ftag.startTag("resetfont")}};tyrano.plugin.kag.tag.ct={start:function(){this.kag.ftag.hideNextImg();this.kag.layer.clearMessageInnerLayerAll();this.kag.layer.getFreeLayer().html("").hide();this.kag.stat.current_layer="message0";this.kag.stat.current_page="fore";this.kag.ftag.startTag("resetfont")}};tyrano.plugin.kag.tag.current={pm:{layer:"",page:"fore"},start:function(e){e.layer==""&&(e.layer=this.kag.stat.current_layer);this.kag.stat.current_layer=e.layer;this.kag.stat.current_page=e.page;this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.position={pm:{layer:"message0",page:"fore",left:"",top:"",width:"",height:"",color:"",opacity:"",vertical:"",frame:"",marginl:"0",margint:"0",marginr:"0",marginb:"0"},start:function(e){var t=this.kag.layer.getLayer(e.layer,e.page).find(".message_outer"),n={left:e.left+"px",top:e.top+"px",width:e.width+"px",height:e.height+"px","background-color":$.convertColor(e.color)};e.vertical=="true"?this.kag.stat.vertical="true":this.kag.stat.vertical="false";if(e.frame=="none"){t.css("opacity",$.convertOpacity(this.kag.config.frameOpacity));t.css("background-image","");t.css("background-color",$.convertColor(this.kag.config.frameColor))}else if(e.frame!=""){var r="";$.isHTTP(e.frame)?r=e.frame:r="./data/image/"+e.frame+"";t.css("background-image","url("+r+")");t.css("background-repeat","no-repeat");t.css("opacity",1);t.css("background-color","")}e.opacity!=""&&t.css("opacity",$.convertOpacity(e.opacity));this.kag.setStyles(t,n);this.kag.layer.refMessageLayer();var i=this.kag.layer.getLayer(e.layer,e.page).find(".message_inner"),s={};e.marginl!="0"&&(s["padding-left"]=parseInt(e.marginl)+"px");e.margint!="0"&&(s["padding-top"]=parseInt(e.margint)+"px");e.marginr!="0"&&(s.width=parseInt(i.css("width"))-parseInt(e.marginr)+"px");e.marginb!="0"&&(s.height=parseInt(i.css("height"))-parseInt(e.marginb)+"px");this.kag.setStyles(i,s);this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.image={pm:{layer:"base",page:"fore",visible:"",top:"",left:"",x:"",y:"",width:"",height:"",pos:"",name:"",folder:""},start:function(e){var t="",n="";if(e.layer!="base"){var r={};e.visible=="true"&&e.page=="fore"&&(r.display="block");this.kag.setStyles(this.kag.layer.getLayer(e.layer,e.page),r);if(e.pos!="")switch(e.pos){case"left":case"l":e.left=this.kag.config["scPositionX.left"];break;case"left_center":case"lc":e.left=this.kag.config["scPositionX.left_center"];break;case"center":case"c":e.left=this.kag.config["scPositionX.center"];break;case"right_center":case"rc":e.left=this.kag.config["scPositionX.right_center"];break;case"right":case"r":e.left=this.kag.config["scPositionX.right"]}e.folder!=""?n=e.folder:n="fgimage";$.isHTTP(e.storage)?t=e.storage:t="./data/"+n+"/"+e.storage;var i=$("<img />");i.attr("src",t);i.css("position","absolute");i.css("top",e.top+"px");i.css("left",e.left+"px");e.width!=""&&i.css("width",e.width+"px");e.height!=""&&i.css("height",e.height+"px");e.x!=""&&i.css("left",e.x+"px");e.y!=""&&i.css("top",e.y+"px");$.setName(i,e.name);this.kag.layer.getLayer(e.layer,e.page).append(i);this.kag.ftag.nextOrder()}else{e.folder!=""?n=e.folder:n="bgimage";$.isHTTP(e.storage)?t=e.storage:t="./data/"+n+"/"+e.storage;var s={"background-image":"url("+t+")",display:"none"};e.page==="fore"&&(s.display="block");this.kag.setStyles(this.kag.layer.getLayer(e.layer,e.page),s);this.kag.ftag.nextOrder()}}};tyrano.plugin.kag.tag.freeimage={vital:["layer"],pm:{layer:"",page:"fore"},start:function(e){e.layer!="base"?this.kag.layer.getLayer(e.layer,e.page).empty():this.kag.layer.getLayer(e.layer,e.page).css("background-image","");this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.ptext={vital:["layer","x","y"],pm:{layer:"0",page:"fore",x:0,y:0,vertical:"false",text:"　　　　　　　　　　　　　　",size:"",face:"",color:"",italic:"",bold:"",name:"",zindex:"9999",overwrite:"false"},start:function(e){var t=this,n={color:e.color,"font-weight":e.bold,"font-style":e.fontstyle,"font-size":e.size+"px","font-family":t.kag.stat.font.face,"z-index":"999",text:""},r=this.kag.layer.getLayer(e.layer,e.page);if(e.overwrite=="true"&&e.name!=""&&$("."+e.name).size()>0){$("."+e.name).html(e.text);this.kag.ftag.nextOrder();return!1}var i=$("<p></p>");i.css("position","absolute");i.css("top",e.y+"px");i.css("left",e.x+"px");i.css("width","100%");e.vertical=="true"&&i.addClass("vertical_text");$.setName(i,e.name);i.html(e.text);this.kag.setStyles(i,n);r.append(i);this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.backlay={pm:{layer:""},start:function(e){this.kag.layer.backlay(e.layer);this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.wt={start:function(e){this.kag.layer.hideEventLayer()}};tyrano.plugin.kag.tag.wb={start:function(e){this.kag.layer.hideEventLayer()}};tyrano.plugin.kag.tag.link={pm:{target:null,storage:null},start:function(e){var t=this,n=this.kag.setMessageCurrentSpan();n.css("cursor","pointer");(function(){var r=e.target,i=e.storage;n.bind("click",function(e){t.kag.ftag.nextOrderWithLabel(r,i);t.kag.layer.showEventLayer()});n.css("cursor","pointer")})();this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.endlink={start:function(e){var t=this.kag.setMessageCurrentSpan();this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.s={start:function(){this.kag.stat.is_strong_stop=!0;this.kag.layer.hideEventLayer()}};tyrano.plugin.kag.tag._s={vital:[],pm:{},start:function(e){this.kag.stat.strong_stop_recover_index=this.kag.ftag.current_order_index;this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.wait={vital:["time"],pm:{time:0},start:function(e){var t=this;this.kag.stat.is_strong_stop=!0;this.kag.layer.hideEventLayer();setTimeout(function(){t.kag.stat.is_strong_stop=!1;t.kag.layer.showEventLayer();t.kag.ftag.nextOrder()},e.time)}};tyrano.plugin.kag.tag.hidemessage={start:function(){this.kag.stat.is_hide_message=!0;this.kag.layer.hideMessageLayers();this.kag.layer.layer_event.show()}};tyrano.plugin.kag.tag.quake={vital:["time"],pm:{count:5,time:300,timemode:"",hmax:null,vmax:10,wait:"true"},start:function(e){var t=this;e.hmax!=null?$("."+this.kag.define.BASE_DIV_NAME).effect("shake",{times:parseInt(e.count),distance:parseInt(e.hmax),direction:"left"},parseInt(e.time),function(){e.wait=="true"&&t.kag.ftag.nextOrder()}):e.vmax>0&&$("."+this.kag.define.BASE_DIV_NAME).effect("shake",{times:parseInt(e.count),distance:parseInt(e.vmax),direction:"up"},parseInt(e.time),function(){e.wait=="true"&&t.kag.ftag.nextOrder()});e.wait=="false"&&t.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.font={pm:{},start:function(e){this.kag.setMessageCurrentSpan();var t={};e.size&&(this.kag.stat.font.size=e.size);e.color&&(this.kag.stat.font.color=$.convertColor(e.color));e.bold&&(this.kag.stat.font.bold=$.convertBold(e.bold));e.face&&(this.kag.stat.font.face=e.face);this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.deffont={pm:{},start:function(e){var t={};e.size&&(this.kag.stat.default_font.size=e.size);e.color&&(this.kag.stat.default_font.color=$.convertColor(e.color));e.bold&&(this.kag.stat.default_font.bold=$.convertBold(e.bold));e.face&&(this.kag.stat.default_font.face=e.face);this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.delay={pm:{speed:""},start:function(e){e.speed!=""&&(this.kag.stat.ch_speed=parseInt(e.speed));this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.nowait={pm:{},start:function(e){this.kag.stat.is_nowait=!0;this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.endnowait={pm:{},start:function(e){this.kag.stat.is_nowait=!1;this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.resetfont={start:function(){var e=this.kag.setMessageCurrentSpan();this.kag.stat.font=$.extend(!0,{},this.kag.stat.default_font);this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.layopt={vital:["layer"],pm:{layer:"",page:"fore",visible:"",left:"",top:"",opacity:"",autohide:!1,index:10},start:function(e){var t=this;if(e.layer=="message"){e.layer=this.kag.stat.current_layer;e.page=this.kag.stat.current_page}var n=this.kag.layer.getLayer(e.layer,e.page);if(e.visible!="")if(e.visible=="true"){e.page=="fore"&&n.css("display","");n.attr("l_visible","true")}else{n.css("display","none");n.attr("l_visible","false")}e.left!=""&&n.css("left",parseInt(e.left));e.top!=""&&n.css("top",parseInt(e.top));e.opacity!=""&&n.css("opacity",$.convertOpacity(e.opacity));this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.ruby={vital:["text"],pm:{text:""},start:function(e){var t=e.text;this.kag.stat.ruby_str=t;this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.cancelskip={start:function(e){this.kag.stat.is_skip=!1;this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.locate={pm:{x:null,y:null},start:function(e){e.x!=null&&(this.kag.stat.locate.x=e.x);e.y!=null&&(this.kag.stat.locate.y=e.y);this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.button={pm:{graphic:"",storage:null,target:null,ext:"",name:"",x:"",y:"",width:"",height:"",fix:"false",savesnap:"false",folder:"image",exp:"",prevar:"",hint:"",clickse:"",enterse:"",leavese:"",clickimg:"",enterimg:"",role:""},start:function(e){var t=this,n=null;e.role!=""&&(e.fix="true");if(e.fix=="false"){n=this.kag.layer.getFreeLayer();n.css("z-index",999999)}else n=this.kag.layer.getLayer("fix");var r="";$.isHTTP(e.graphic)?r=e.graphic:r="./data/"+e.folder+"/"+e.graphic;var i=$("<img />");i.attr("src",r);i.css("position","absolute");i.css("cursor","pointer");i.css("z-index",99999999);e.x==""?i.css("left",this.kag.stat.locate.x+"px"):i.css("left",e.x+"px");e.y==""?i.css("top",this.kag.stat.locate.y+"px"):i.css("top",e.y+"px");e.fix!="false"&&i.addClass("fixlayer");e.width!=""&&i.css("width",e.width+"px");e.height!=""&&i.css("height",e.height+"px");e.hint!=""&&i.attr({title:e.hint,alt:e.hint});$.setName(i,e.name);(function(){var n=e.target,r=e.storage,s=e,o=t.kag.embScript(e.preexp),u=!1;i.hover(function(){s.enterse!=""&&t.kag.ftag.startTag("playse",{storage:s.enterse,stop:!0});if(s.enterimg!=""){var e="";$.isHTTP(s.enterimg)?e=s.enterimg:e="./data/"+s.folder+"/"+s.enterimg;$(this).attr("src",e)}},function(){s.leavese!=""&&t.kag.ftag.startTag("playse",{storage:s.leavese,stop:!0});if(s.enterimg!=""){var e="";$.isHTTP(s.graphic)?e=s.graphic:e="./data/"+s.folder+"/"+s.graphic;$(this).attr("src",e)}});i.click(function(e){s.clickse!=""&&t.kag.ftag.startTag("playse",{storage:s.clickse});if(s.clickimg!=""){var n="";$.isHTTP(s.clickimg)?n=s.clickimg:n="./data/"+s.folder+"/"+s.clickimg;i.attr("src",n)}if(u==1&&s.fix=="false")return!1;if(t.kag.stat.is_strong_stop!=1&&s.fix=="false")return!1;u=!0;s.exp!=""&&t.kag.embScript(s.exp,o);if(s.savesnap=="true"){if(t.kag.stat.is_stop==1)return!1;t.kag.menu.snapSave(t.kag.stat.current_message_str)}if(s.role!=""){if(t.kag.layer.layer_event.css("display")=="none")return!1;if(t.kag.stat.is_strong_stop==1)return!1;switch(s.role){case"save":t.kag.menu.displaySave();break;case"load":t.kag.menu.displayLoad();break;case"window":t.kag.layer.hideMessageLayers();break;case"title":if(!confirm("タイトルに戻ります。よろしいですね？"))return!1;location.reload();break;case"menu":t.kag.ftag.startTag("showmenu",{});break;case"skip":t.kag.ftag.startTag("skipstart",{});break;case"backlog":t.kag.ftag.startTag("showlog",{})}e.stopPropagation();return!1}t.kag.layer.showEventLayer();s.role==""&&s.fix=="true"?t.kag.ftag.startTag("call",s):t.kag.ftag.startTag("jump",s)})})();n.append(i);e.fix=="false"&&n.show();this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.glink={pm:{color:"black",storage:null,target:null,name:"",text:"",x:"auto",y:"",clickse:"",width:"",height:"",size:30},start:function(e){var t=this,n=null;n=this.kag.layer.getFreeLayer();n.css("z-index",999999);var r=$("<div class='button'>"+e.text+"</div>");r.css("position","absolute");r.css("cursor","pointer");r.css("z-index",99999999);r.css("font-size",e.size+"px");r.addClass(e.color);e.height!=""&&r.css("height",e.height+"px");e.width!=""&&r.css("width",e.width+"px");if(e.x=="auto"){var i=n.find(".tyrano_chara").length,s=parseInt(t.kag.config.scWidth),o=Math.floor(parseInt(r.css("width"))/2),u=Math.floor(s/2),a=u-o;r.css("left",a+"px")}else e.x==""?r.css("left",this.kag.stat.locate.x+"px"):r.css("left",e.x+"px");e.y==""?r.css("top",this.kag.stat.locate.y+"px"):r.css("top",e.y+"px");$.setName(r,e.name);(function(){var n=e.target,i=e.storage,s=e,o=t.kag.embScript(e.preexp),u=!1;r.click(function(){s.clickse!=""&&t.kag.ftag.startTag("playse",{storage:s.clickse});if(t.kag.stat.is_strong_stop!=1)return!1;u=!0;s.exp!=""&&t.kag.embScript(s.exp,o);t.kag.layer.showEventLayer();t.kag.ftag.startTag("cm",{});t.kag.ftag.startTag("jump",s)})})();n.append(r);n.show();this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.clickable={vital:["width","height"],pm:{width:"0",height:"0",x:"",y:"",border:"none",color:"",mouseopacity:"",opacity:"140",storage:null,target:null,name:""},start:function(e){var t=this,n=this.kag.layer.getFreeLayer();n.css("z-index",9999999);var r=$("<div />");r.css("position","absolute");r.css("cursor","pointer");r.css("top",this.kag.stat.locate.y+"px");r.css("left",this.kag.stat.locate.x+"px");r.css("width",e.width+"px");r.css("height",e.height+"px");r.css("opacity",$.convertOpacity(e.opacity));r.css("background-color",$.convertColor(e.color));r.css("border",$.replaceAll(e.border,":"," "));e.x!=""&&r.css("left",parseInt(e.x));e.y!=""&&r.css("top",parseInt(e.y));(function(){var n=e.target,i=e.storage,s=e;if(s.mouseopacity!=""){r.bind("mouseover",function(){r.css("opacity",$.convertOpacity(s.mouseopacity))});r.bind("mouseout",function(){r.css("opacity",$.convertOpacity(s.opacity))})}r.click(function(){var e=function(e){return e.kag.stat.is_strong_stop!=1?!1:!0}(t);if(e==0)return!1;t.kag.ftag.startTag("cm",{});t.kag.layer.showEventLayer();t.kag.ftag.startTag("jump",s)})})();n.append(r);n.show();this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.glyph={pm:{line:"nextpage.gif",layer:"message0",fix:"false",left:0,top:0},start:function(e){var t=this;$("#glyph_image").remove();if(e.fix=="true"){var n=this.kag.layer.getLayer(e.layer),r=$("<img id='glyph_image' />");r.attr("src","./tyrano/images/kag/"+e.line);r.css("position","absolute");r.css("z-index",99999);r.css("top",e.top+"px");r.css("left",e.left+"px");r.css("display","none");n.append(r);this.kag.stat.flag_glyph="true"}else this.kag.stat.flag_glyph="false";this.kag.ftag.nextOrder()}};tyrano.plugin.kag.tag.trans={vital:["time"],pm:{layer:"base",method:"crossfade",children:!0,time:1500},start:function(e){this.kag.ftag.hideNextImg();var t=this,n=0,r=$.countObj(this.kag.layer.map_layer_fore);e.children=="false"&&(r=0);for(key in this.kag.layer.map_layer_fore)(e.children==1||key===e.layer)&&function(){var i=key,s=t.kag.layer.map_layer_fore[i],o=t.kag.layer.map_layer_back[i];if(i.indexOf("message")!=-1&&o.attr("l_visible")=="false"){n++;t.kag.layer.forelay(i)}else{$.trans(e.method,s,parseInt(e.time),"hide",function(){});o.css("display","none");$.trans(e.method,o,parseInt(e.time),"show",function(){n++;t.kag.layer.forelay(i);r<=n&&t.kag.ftag.completeTrans();t.kag.ftag.hideNextImg()})}}();this.kag.ftag.nextOrder()}};